"use strict";(self["webpackChunkmobile2_0"]=self["webpackChunkmobile2_0"]||[]).push([[7748],{37748:function(e,l,a){a.r(l),a.d(l,{default:function(){return $}});a(43290),a(9653),a(38862),a(91058),a(41539);var n=a(70655),t=a(77577),s=a(30381),r=a.n(s),o=a(63742),i=a(65655),c=a(75370),u=a(16978),d=a(26979),p=a(1075),v=a(37246),m=a(28339),_=a(8802),f=a(28989),y=a(27486),w=a(94396),C=a(38194),g=a(56022),k=["onClick"],h=["onClick"],E=(0,t.defineComponent)((0,n.pi)({name:"NumberRollcallAnswer"},{__name:"answer",setup:function(e){var l=this,a=(0,m.yj)(),s=(0,_.QT)(),E=a.params.courseId,N=a.params.rollcallId,I=(0,t.ref)(!1),B=(0,t.ref)(!1),b=(0,t.ref)(new Array(4).fill(null)),$=(0,t.ref)(0),M=(0,t.computed)((function(){return!(I.value||B.value)})),L=(0,t.ref)([]),R=function(){var e;null===(e=L.value[$.value])||void 0===e||e.focus()};(0,t.onMounted)((function(){setTimeout((function(){R()}),300)}));var T=function(e){L.value[e].focus()},V=function(e){M.value&&"Backspace"===e.key&&(b.value[$.value]=null,$.value>=1&&($.value-=1,R()))},S=function(e){if(M.value&&e.data){var l=Number(e.data);isNaN(l)||(b.value[$.value]=l,$.value<b.value.length-1&&($.value+=1))}},z=function(){b.value=[null,null,null,null],$.value=0,B.value=!1},D=(0,t.ref)(""),O=(0,t.ref)(!1),x=(0,t.ref)(!1),A=g.Z.get("number-rollcall"),Z=function(e){return x.value=!1,e.errorCode===C.B.ROLLCALL_DEVICE_ALREADY_IN_USE?(D.value=s.t("rollcall.errorMsg.deviceAlreadyInUse"),void(O.value=!0)):e.errorCode===C.B.NUMBER_ROLLCALL_WRONG_NUMBER_CODE||400===e.status?(u.ZP.showMessage(s.t("rollcall.errorMsg.wrongNumberCode")),B.value=!0,void setTimeout(z,1e3)):(O.value=!0,A.info("check-in failed and unknown error. response is ",JSON.stringify({status:e.status,data:e.data,errorCode:e.errorCode},null,2)),404===e.status?(D.value=s.t("rollcall.errorMsg.rollcallFinished"),void f.Z.willBeRefresh([y.q.RollcallList,y.q.OngoingRollcallList,y.q.MergedRollcallDetail])):void(D.value=s.t("rollcall.errorMsg.failed")))},U=function(){O.value=!0,x.value=!0,D.value=r()().format(d.Format.DATETIME_FORMAT_NO_SECONDS),p.ZP.trackDashBoard({activityId:parseInt(N),activityType:v.ss.activityType.ROLLCALL,subType:v.ss.rollcallType.NUMBER,action:v.ss.rollcallAction.SIGN},{enrollment:c.EN.Student,id:parseInt(E)}),f.Z.willBeRefresh([y.q.RollcallList,y.q.OngoingRollcallList,y.q.MergedRollcallDetail])},q=function(){return(0,n.mG)(l,void 0,void 0,(function(){var e,l;return(0,n.Jh)(this,(function(a){switch(a.label){case 0:return A.info("start check-in."),I.value=!0,e={deviceId:w.Z.deviceId,numberCode:b.value.join("")},A.info("fetch check-in api. payload is",JSON.stringify({rollcallId:N,payload:e},null,2)),[4,i.Z.answerNumberRollcall(N,e)];case 1:return l=a.sent(),I.value=!1,200===l.status?(A.info("check-in successful."),U()):(A.error("check-in failed."),Z(l)),A.info("complete check-in."),[2]}}))}))};return(0,t.watch)(b,(function(){N&&4===b.value.length&&b.value.every((function(e){return"number"===typeof e}))&&q()}),{deep:!0}),function(e,l){var a=(0,t.resolveComponent)("header-component"),n=(0,t.resolveComponent)("svg-icon"),s=(0,t.resolveComponent)("ion-content"),r=(0,t.resolveComponent)("ion-page");return(0,t.openBlock)(),(0,t.createBlock)(r,null,{default:(0,t.withCtx)((function(){return[(0,t.createVNode)(a,{class:(0,t.normalizeClass)(e.$style.header),options:{title:e.$t("rollcall.type.number")}},null,8,["class","options"]),(0,t.createVNode)(s,{class:(0,t.normalizeClass)(e.$style.content)},{default:(0,t.withCtx)((function(){var l;return[(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.container)},[(0,t.createVNode)(o.Z,{"is-paper-out":O.value,class:(0,t.normalizeClass)((l={},l[e.$style.paperBox]=!0,l[e.$style.noPointerEvents]=!O.value,l))},{default:(0,t.withCtx)((function(){return[O.value?((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:0},[x.value?((0,t.openBlock)(),(0,t.createElementBlock)("div",{key:0,class:(0,t.normalizeClass)([e.$style.paper,"flex"])},[(0,t.createVNode)(n,{class:(0,t.normalizeClass)(e.$style.resultIcon),name:"success"},null,8,["class"]),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.resultTitle),"data-testid":"resultTitle"},(0,t.toDisplayString)(e.$t("rollcall.success")),3),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.resultMsg),"data-testid":"resultMsg"},(0,t.toDisplayString)(D.value),3)],2)):((0,t.openBlock)(),(0,t.createElementBlock)("div",{key:1,class:(0,t.normalizeClass)([e.$style.paper,"flex"])},[(0,t.createVNode)(n,{class:(0,t.normalizeClass)(e.$style.resultIcon),name:"fail"},null,8,["class"]),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.resultTitle),"data-testid":"resultTitle"},(0,t.toDisplayString)(e.$t("rollcall.failed")),3),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.resultMsg),"data-testid":"resultMsg"},(0,t.toDisplayString)(D.value),3)],2))],64)):(0,t.createCommentVNode)("",!0)]})),_:1},8,["is-paper-out","class"]),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.inputContainer)},[(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.label)},(0,t.toDisplayString)(e.$t("rollcall.pleaseInputPassword")),3),(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(["flex",e.$style.passwordInput])},[(0,t.withDirectives)((0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(e.$style.loading)},null,2),[[t.vShow,I.value]]),((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(b.value,(function(l,a){var n;return(0,t.openBlock)(),(0,t.createElementBlock)("div",{class:(0,t.normalizeClass)([e.$style.inputChar,(n={},n[e.$style.currentInput]=$.value===a,n[e.$style.hasError]=B.value,n)]),key:a,onClick:function(e){return $.value=a}},[O.value?(0,t.createCommentVNode)("",!0):((0,t.openBlock)(),(0,t.createElementBlock)("input",{key:0,ref_for:!0,ref_key:"inputsRef",ref:L,class:(0,t.normalizeClass)(e.$style.input),type:"tel",onKeydown:V,"on:textInput":S,"data-testid":"passwordInput"},null,34)),(0,t.createElementVNode)("div",{"data-testid":"passwordInputBox",class:(0,t.normalizeClass)(e.$style.mask),onClick:function(e){return T(a)}},[(0,t.createElementVNode)("div",{class:(0,t.normalizeClass)(["hkgrotesk-bold",e.$style.char])},(0,t.toDisplayString)(b.value[a]),3),(0,t.withDirectives)((0,t.createElementVNode)("div",{class:(0,t.normalizeClass)([e.$style.indicator,e.$style.blinkingCursor])},null,2),[[t.vShow,!I.value]])],10,h)],10,k)})),128))],2)],2)],2)]})),_:1},8,["class"])]})),_:1})}}})),N={markdownBody:"answer__markdown-body-h0BE8",loginTypeLogo:"answer__login-type-logo-vlppa",loginTemplateTitle:"answer__login-template-title-Ii7A_",loginTemplateLoginOptions:"answer__login-template-loginOptions-JDXJg",modalOnTop:"answer__modal-on-top-yxWDZ",modalWrapper:"answer__modal-wrapper-OfdOA",scIonModalIos:"answer__sc-ion-modal-ios-w9rAS",modalFullscreen:"answer__modal-fullscreen-B4I4n",scIonModalIosH:"answer__sc-ion-modal-ios-h-JjfRX",header:"answer__header-Xm_nw",paperBox:"answer__paperBox-Ue3_X",noPointerEvents:"answer__noPointerEvents-WSBFo",loading:"answer__loading-qaxl9",move:"answer__move-T_hit",passwordInput:"answer__passwordInput-LoSec",inputChar:"answer__inputChar-KQiwT",currentInput:"answer__currentInput-s1lUX",blinkingCursor:"answer__blinkingCursor-gxb99",blink:"answer__blink-MAlVP",indicator:"answer__indicator-jwbMb",hasError:"answer__hasError-pUIyL",char:"answer__char-UCcWR",input:"answer__input-_rxtf",mask:"answer__mask-VSxCo",content:"answer__content-ybCQR",container:"answer__container-Y0VmS",paper:"answer__paper-Zajqy",resultIcon:"answer__resultIcon-Lic4D",resultTitle:"answer__resultTitle-iZGHy",resultMsg:"answer__resultMsg-uMnSi",inputContainer:"answer__inputContainer-SkZ0D",label:"answer__label-PQHQ5"},I=a(46021);const B={};B["$style"]=N;const b=(0,I.Z)(E,[["__cssModules",B],["__scopeId","data-v-b7b3651e"]]);var $=b}}]);